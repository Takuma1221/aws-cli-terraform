# S3 静的ウェブサイトホスティング vs CloudFront + S3 構成比較

このドキュメントでは、これまでの「S3 静的ウェブサイトホスティング」構成と、これから導入する「CloudFront + S3」構成の違い、それぞれのメリット・デメリットについて解説します。

## 1. 構成の概要

### 🅰️ これまでの構成 (S3 静的ウェブサイトホスティング)

ユーザーが直接 S3 バケットのウェブサイトエンドポイントにアクセスするシンプルな構成です。

- **アクセス経路**: ユーザー -> S3 バケット
- **IP 制限**: S3 バケットポリシーで実装

### 🅱️ 新しい構成 (CloudFront + S3)

ユーザーは CloudFront（CDN）のエッジロケーションにアクセスし、CloudFront が S3 からコンテンツを取得して配信する構成です。

- **アクセス経路**: ユーザー -> CloudFront -> S3 バケット
- **IP 制限**: AWS WAF (Web Application Firewall) で実装

## 2. 比較表

| 特徴               | S3 静的ウェブサイトホスティング   | CloudFront + S3                        |
| :----------------- | :-------------------------------- | :------------------------------------- |
| **通信プロトコル** | **HTTP のみ** (HTTPS 不可)        | **HTTPS (SSL/TLS) 対応**               |
| **パフォーマンス** | リージョン依存 (遠いと遅い)       | **高速** (世界中のエッジでキャッシュ)  |
| **セキュリティ**   | S3 バケットを一部公開する必要あり | **S3 を完全非公開にできる** (OAC 使用) |
| **IP 制限**        | S3 バケットポリシー (無料)        | **AWS WAF** (有料、高機能)             |
| **独自ドメイン**   | Route53 が必要だが HTTPS 化は不可 | ACM と連携して**容易に HTTPS 化可能**  |
| **コスト**         | 安価 (S3 料金のみ)                | S3 料金 + CloudFront 転送料 + WAF 料金 |
| **設定の複雑さ**   | シンプル                          | やや複雑                               |

## 3. CloudFront を使うメリット

1.  **HTTPS (SSL/TLS) 通信が可能になる**

    - S3 の静的ウェブサイトホスティング機能だけでは、`http://` でのアクセスしかできません。
    - CloudFront を使うことで、デフォルトで `https://` が利用可能になり、通信が暗号化され安全になります。

2.  **セキュリティの向上 (S3 の非公開化)**

    - Origin Access Control (OAC) という機能を使うことで、S3 バケットへの直接アクセスを完全に禁止し、CloudFront 経由のアクセスのみを許可できます。
    - これにより、意図しない経路からのデータ流出リスクを減らせます。

3.  **パフォーマンスの向上**

    - CloudFront は世界中にキャッシュサーバー（エッジロケーション）を持っています。
    - ユーザーに最も近いサーバーからコンテンツを配信するため、表示速度が向上します。

4.  **高度なアクセス制御 (WAF)**
    - AWS WAF を CloudFront にアタッチすることで、IP 制限だけでなく、SQL インジェクション対策や国別のアクセス制限など、高度なセキュリティ対策が可能になります。

## 4. 注意点 (コストについて)

CloudFront 構成に変更すると、以下のコストが追加で発生する可能性があります。

- **CloudFront データ転送量**: インターネットへの送信量に応じた従量課金（毎月 1TB までは無料枠あり）。
- **AWS WAF**:
  - Web ACL 利用料: 月額 $5.00 (約 750 円)
  - ルール利用料: 1 ルールあたり月額 $1.00 (約 150 円)
  - リクエスト料金: 100 万リクエストあたり $0.60

※ 学習用で短期間の使用であれば数ドル程度で済みますが、放置すると WAF の固定費がかかるため、**使用後は必ず `terraform destroy` でリソースを削除することを推奨します。**
